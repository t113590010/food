<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>È¶ñÈ†Å</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <script src="js/script.js"></script>
    <div class="page-wrapper" <!-- navbar -->
        {% include 'navbar.html' %}

        <!-- body -->
        <!-- AI -->
        <div id="ai-chat-btn">
            ü§ñ
        </div>

    <div id="ai-chat-window">
        <div class="chat-header">
            <span>AI È§êÂª≥Â∞èÂπ´Êâã</span>
            <span id="chat-close-btn" class="close-btn">√ó</span>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="message ai-message">
                Âó®ÔºÅÊàëÊòØ‰Ω†ÁöÑÂ∞àÂ±¨ AI Âä©Êâã üëã<br>ÊÉ≥Êü•Ë®ÇÂñÆÊàñÊòØÊé®Ëñ¶ÁæéÈ£üÂóéÔºü
            </div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ...">
            <button id="chat-send-btn">ÈÄÅÂá∫</button>
        </div>
    </div>
    <!-- È¶ñÈ†Å ÊâÄÊúâË®ÇÂñÆ -->
    {% if (url=='1' or upd_food_data) and not upd_card_data %}
 
        <div class="hero-bar">
            <div class="hero-left">
                <h1>Ê∫ñÂÇôÂ•Ω‰∫´ÂèóÁæéÈ£ü‰∫ÜÂóéÔºü</h1>
                <p>ÂæûÁ≤æÈÅ∏È§êÈªû‰∏≠ÔºåÊâæÂà∞‰ªäÂ§©ÊúÄÊÉ≥ÂêÉÁöÑÈÇ£‰∏ÄÈÅì üçΩÔ∏è</p>
            </div>
            <div class="hero-right">
                <span class="total-label">ÁõÆÂâçÁ∏ΩÈáëÈ°ç</span>
                <span class="total-price">NT$ <span id="total">0</span></span>
            </div>
        </div>

        <div class="card-body">
            {% if upd_food_data is not none %}

                <form action="/upd_del_done_food" method="post">
                    <div class="container">
                        <div class="row">
                            <div class="col-8">
                                <div class="card food-select-card p-3">
                                    <div class="row g-3">

                                    {% for s in food_types %}
                                    <div class="col-3">
                                        <div class="card food-item-card h-100">

                                        <div class="food-img-wrap text-center">
                                            <img src="{{ s.img }}" class="pre_img_sm" alt="">
                                        </div>

                                        <div class="food-card-body">
                                            <h4 class="food-title">{{ s.name }}</h4>
                                            <p class="food-desc">{{ s.content }}</p>

                                            <div class="food-meta mt-auto">
                                            <div class="d-flex justify-content-between">
                                                <span>Â≠òË≤®</span>
                                                <strong>{{ s.count }}</strong>
                                            </div>
                                            <div class="d-flex justify-content-between price">
                                                <span>ÂñÆÂÉπ</span>
                                                <strong>{{ s.price }} ÂÖÉ</strong>
                                            </div>

                                            <label class="mt-2">Êï∏Èáè</label>
                                            <input type="number"
                                                    min="0"
                                                    max="{{s.count}}"
                                                    class="form-control count"
                                                    data-price="{{ s.price }}"
                                                    name="count[{{ s.id }}]"
                                                    value="{% if upd_food_data and s.id in upd_food_data['food_type_id'] -%}{{ upd_food_data['food_counts'][upd_food_data['food_type_id'].index(s.id)] -}}{% else %}0{% endif %}"
                                                    required>
                                            </div>
                                        </div>

                                        </div>
                                    </div>
                                    {% endfor %}

                                    </div>
                                </div>
                            </div>

                            <div class="col">
                                <div class="card order-detail-card p-4">

                                    <!-- Âü∫Êú¨Ë≥áË®ä -->
                                    <div class="order-info">
                                    <h3 class="order-id">Ë®ÇÂñÆ #{{ upd_food_data['id'] }}</h3>

                                    <div class="order-meta">
                                        <p><strong>ÂÆ¢Êà∂ÂêçÁ®±Ôºö</strong>{{ upd_food_data['user_name'] }}</p>
                                        <p><strong>EmailÔºö</strong>{{ upd_food_data['user_email'] }}</p>
                                        <p><strong>ÂÇôË®ªÔºö</strong>{{ "ÁÑ°" if upd_food_data['content'] == "" else upd_food_data['content'] }}</p>
                                        <p><strong>Ë®ÇÂñÆÊó•ÊúüÔºö</strong>{{ upd_food_data['date'] }}</p>
                                    </div>
                                    </div>

                                    <hr>

                                    <!-- Êìç‰ΩúÂçÄ -->
                                    <div class="order-actions">

                                    {% if session['user']['level'] == 1 %}

                                        {% if upd_food_data['done'] == 1 %}

                                        {% if session['user']['id'] == 1 and upd_food_data['user_id'] %}
                                        <button type="submit"
                                                class="btn btn-success w-100 mb-2"
                                                name="get"
                                                value="{{ upd_food_data['id'] }}">
                                            È†òÂèñË®ÇÂñÆ
                                        </button>
                                        {% endif %}

                                        <button type="submit"
                                                class="btn btn-warning w-100"
                                                name="Nodone"
                                                value="{{ upd_food_data['id'] }}">
                                            ÂèñÊ∂àÂÆåÊàê
                                        </button>

                                        {% else %}

                                        <button type="submit"
                                                class="btn btn-success w-100 mb-3"
                                                name="done"
                                                value="{{ upd_food_data['id'] }}">
                                            ÂÆåÊàêË®ÇÂñÆ
                                        </button>

                                        <div class="row g-2">
                                            <div class="col">
                                            <button type="submit"
                                                    class="btn btn-primary w-100"
                                                    name="upd"
                                                    value="{{ upd_food_data['id'] }}">
                                                ‰øÆÊîπÈ§êÈªû
                                            </button>
                                            </div>
                                            <div class="col">
                                            <button type="submit"
                                                    class="btn btn-danger w-100"
                                                    name="del"
                                                    value="{{ upd_food_data['id'] }}">
                                                Âà™Èô§Ë®ÇÂñÆ
                                            </button>
                                            </div>
                                        </div>

                                        {% endif %}

                                    {% else %}

                                        {% if upd_food_data['done'] == 1 %}

                                        <button type="submit"
                                                class="btn btn-success w-100"
                                                name="get"
                                                value="{{ upd_food_data['id'] }}">
                                            È†òÂèñË®ÇÂñÆ
                                        </button>

                                        {% else %}

                                        <div class="order-status">
                                            <h4>ÁãÄÊÖãÔºöÈ§êÈªûÊ∫ñÂÇô‰∏≠</h4>
                                        </div>

                                        <div class="row g-2 mt-3">
                                            <div class="col">
                                            <button type="submit"
                                                    class="btn btn-primary w-100"
                                                    name="upd"
                                                    value="{{ upd_food_data['id'] }}">
                                                ‰øÆÊîπÈ§êÈªû
                                            </button>
                                            </div>
                                            <div class="col">
                                            <button type="submit"
                                                    class="btn btn-danger w-100"
                                                    name="del"
                                                    value="{{ upd_food_data['id'] }}">
                                                Âà™Èô§Ë®ÇÂñÆ
                                            </button>
                                            </div>
                                        </div>

                                        {% endif %}

                                    {% endif %}

                                    </div>
                                </div>
                            </div>
                        </div>

                </div>
            </form>

            {% else %}
            <div class="main-container">

                    <aside class="filter-sidebar">
                        <h3>üç¥ ÁØ©ÈÅ∏Ê¢ù‰ª∂</h3>

                        <form action="/" method="GET">

                            <input type="hidden" name="keyword" value="{{ request.args.get('keyword', '') }}">

                            <div class="filter-group">
                                <h4>È§êÈªûÈ°ûÂà•</h4>

                                {% for code, name in category_map.items() %}

                                <label class="checkbox-item">
                                    <input type="checkbox" name="category" value="{{ code }}" {% if code in
                                        request.args.getlist('category') %} checked {% endif %}>

                                    {{ name }}
                                </label>

                                {% endfor %}
                            </div>

                            <div class="filter-group">
                                <h4>ÂÉπÊ†ºÁØÑÂúç</h4>
                                <div class="price-inputs">
                                    <input type="number" name="min_price" placeholder="ÊúÄ‰Ωé"
                                        value="{{ request.args.get('min_price', '') }}">
                                    <span> - </span>
                                    <input type="number" name="max_price" placeholder="ÊúÄÈ´ò"
                                        value="{{ request.args.get('max_price', '') }}">
                                </div>
                            </div>

                            <div class="filter-group">
                                <h4>ÊéíÂ∫è</h4>
                                <label class="radio-item">
                                    <input type="radio" name="sort" value="newest" checked> ÊúÄÊñ∞‰∏äÊû∂
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="sort" value="price_asc"> ÂÉπÊ†ºÔºö‰ΩéÂà∞È´ò
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="sort" value="price_desc"> ÂÉπÊ†ºÔºöÈ´òÂà∞‰Ωé
                                </label>
                            </div>

                            <button type="submit" class="filter-btn">Â•óÁî®ÁØ©ÈÅ∏</button>
                            <a href="/" class="reset-btn">Ê∏ÖÈô§ÈáçÁΩÆ</a>
                        </form>
                    </aside>

                    <main class="content-area">

                        <div class="top-search-bar">
                            <form action="/" method="GET" class="search-form">
                                <input type="text" name="keyword" placeholder="ÊêúÂ∞ãÊÉ≥ÂêÉÁöÑÁæéÈ£ü..."
                                    value="{{ request.args.get('keyword', '') }}">
                                <button type="submit">üîç ÊêúÂ∞ã</button>
                            </form>
                        </div>

                        <form action="/tmp_food" method="post">

                            <div class="food-grid">
                                {% if food_types %}
                                {% for s in food_types %}


                                <div class="food-card">

                                    <div class="text-center">
                                        <img src="{{ s.img }}" class="pre_img card-img" alt="">
                                    </div>
                                    <div class="card-info">

                                        <h4>È§êÈªû:{{ s.name }}</h4>
                                        <h5>È°ûÂûã:{{ category_map[s.type] }}</h5>
                                        <p>ÊïòËø∞:{{ s.content }}</p>
                                        <div class="mt-auto">
                                            <h5>Ââ©È§òÂ≠òË≤®:{{s.count}}</h5>
                                            <h5>ÂñÆÂÉπ: {{ s.price }}</h5>
                                            <label for="count_{{ s.id }}">Êï∏Èáè</label>
                                            <input type="number" min="0" max="{{s.count}}" class="form-control count"
                                                data-price="{{ s.price }}" name="count[{{ s.id }}]"
                                                value="{% if session.get('tmp_order') and s.id in session['tmp_order']['food_type_ids'] %}{{ session['tmp_order']['counts'][session['tmp_order']['food_type_ids'].index(s.id)] }}{% else %}0{% endif %}">

                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <div class="empty-state">
                                    <h3>Êâæ‰∏çÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÈ§êÈªû</h3>
                                    <p>Ë©¶Ë©¶Ë™øÊï¥ÁØ©ÈÅ∏Ê¢ù‰ª∂ÔºåÊàñÁõ¥Êé•ÁúãÁúãÂÖ®ÈÉ®ÁæéÈ£üÂêß üçú</p>
                                </div>

                                {% endif %}
                            </div>

                            <div class="mt-3 text-center">
                                <button type="submit" class="btn btn-outline-primary" id="add_food">Âä†ÂÖ•È§êÈªû</button>
                            </div>
                        </form>
                    </main>
                </div>

                {% endif %}


            </div>
        </div>

    {% endif %}
    <!-- ÊúÉÂì°ÁÆ°ÁêÜ -->
    {% if url=='2' %}
    <div class="card">
        <div class="card-header">
            <h2>ÊúÉÂì°ÁÆ°ÁêÜ</h2>
        </div>
        <div class="card-body">
            <table border="1" cellpadding="8" class="table">
                <thead>
                    <tr>
                        <th class="col-2">Â∏≥Ëôü</th>
                        <th class="col-2">ÂØÜÁ¢º</th>
                        <th class="col-2">ÂêçÁ®±</th>
                        <th class="col-2">email</th>
                        <th>Ê¨äÈôê</th>
                        <th >ÈäÄË°åÂç°Ë≥áË®ä</th>
                        <th >Èå¢ÂåÖ</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in users %}
                    <tr>
                        <form action="/UpdAndDelUsers" method="post">
                            <td><input type="text" class="form-control" value="{{ s.account }}" name="account"></td>
                            <td><input type="number" min="1" class="form-control" value="{{ s.password }}"
                                    name="password"></td>
                            <td><input type="name" class="form-control" value="{{ s.name }}" name="name"></td>
                            <td><input type="email" class="form-control" value="{{ s.email }}" name="email"></td>

                            <td>
                                {% if 'user' in session and session['user']['level']==1 %}
                                <select name="level" class="form-select">
                                    <option value="0" {% if 0==s.level %} selected{% endif %}>‰ΩøÁî®ËÄÖ</option>
                                    <option value="1" {% if 1==s.level %} selected{% endif %}>ÁÆ°ÁêÜÂì°</option>
                                </select>
                                {% else %}
                                <p>‰ΩøÁî®ËÄÖ
                                <p>
                                    {% endif %}
                            </td>
                            <td>
                                <a href="/?upd_card={{s.id}}" class="btn btn-outline-secondary">ÈäÄË°åÂç°</a>
                            </td>
                            <td>{{s.cash}}</td>
                            <td>
                                <button class="btn btn-outline-warning" name="upd" value="{{s.id}}">‰øÆÊîπ</button>
                                <button class="btn btn-outline-danger" name="del" value="{{s.id}}"
                                    onclick="return confirm('Á¢∫ÂÆöÂà™Èô§?')">Âà™Èô§</button>
                            </td>
                        </form>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>


            </div>
            {% endif %}
            <!-- È£üÁâ©È°ûÂûãÁÆ°ÁêÜ -->
            {% if 'user' in session and session['user']['level']==1 and url=='3' %}

            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-5">


                            <h2>Êñ∞Â¢ûËèúÂñÆÈ°ûÂûã</h2>
                            <form action="/add_foodtype" method="post" enctype="multipart/form-data">
                                <div class="row">
                                    <div class="row">
                                        <div class="col text-center">
                                            <h5>È†êË¶ΩÂúñÁâá</h5>
                                            <img src="" class="pre_img" alt="">
                                            <label for="img" class="btn form-control btn-outline-secondary">‰∏äÂÇ≥ÂúñÁâá</label>
                                            <input type="file" name="img" id="img" hidden>
                                        </div>
                                    </div>


                                    <label for="">ËèúÂñÆÈ°ûÂûãÂêçÁ®±</label>
                                    <input type="text" value="" class="form-control" name="name" required
                                        placeholder="Ëº∏ÂÖ•ÂêçÁ®±">
                                    <label for="">È£üÁâ©È°ûÂûã</label>
                                    <select name="category" class="form-select">
                                        {% for code, name in category_map.items() %}
                                        <option value="{{ code }}" selected>
                                            {{ name }} </option>
                                        {% endfor %}

                                    </select>
                                    <label for="">ÂÉπÊ†º</label>
                                    <input type="number" min="1" value="" class="form-control" name="price" required
                                        placeholder="Ëº∏ÂÖ•ÂÉπÊ†º">
                                    <label for="">ÊïòËø∞</label>
                                    <textarea name="content" class="form-control" id="" required
                                        placeholder="Ëº∏ÂÖ•ÊïòËø∞"></textarea>



                                </div>
                                <div class="mt-3 text-center">
                                    <button type="submit" class="btn btn-outline-primary col-3">Êñ∞Â¢û</button>
                                </div>
                            </form>

                        </div>
                        <div class="col">
                            <h2>Â∑≤ÊúâËèúÂñÆÈ°ûÂûã</h2>
                            <table border="1" cellpadding="8" class="table table-striped">
                                <thead>
                                    <tr>
                                        <th class="col-2">ÂúñÁâá</th>
                                        <th>ËèúÂñÆÈ°ûÂûãÂêçÁ®±</th>
                                        <th class="col-2">È°ûÂûã</th>
                                        <th class="col-2">ÂÉπÈå¢</th>
                                        <th class="col-2">Â≠òË≤®</th>
                                        <th>ÊïòËø∞</th>
                                        <!-- <th>Êìç‰Ωú</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for s in food_types %}
                                    <form action="/UpdAndDelFoodType" method="post" enctype="multipart/form-data">
                                        <tr>
                                            <td><img src="{{s.img}}" class="pre_img_sm" alt="" id="pre_img_sm_{{s.id}}">
                                            </td>
                                            <td><input type="text" class="form-control" value="{{ s.name }}"
                                                    name="name">
                                            </td>
                                            <td>
                                                <select name="category" class="form-select">

                                                    {% for code, name in category_map.items() %}

                                                    <option value="{{ code }}" {% if s.type==code %} selected {% endif
                                                        %}>

                                                        {{ name }} </option>

                                                    {% endfor %}

                                                </select>
                                            </td>
                                            <td><input type="number" min="1" class="form-control" value="{{ s.price }}"
                                                    name="price"></td>
                                            <td><input type="number" min="0" class="form-control" value="{{ s.count }}"
                                                    name="count"></td>
                                            <td> <textarea class="form-control" name="content"
                                                    id="">{{ s.content }}</textarea>
                                            </td>
                                        </tr>
                                        <tr>

                                            <td colspan="5">
                                                <div class="d-flex align-items-center gap-2">

                                                    <label for="img_sm_{{s.id}}"
                                                        class="btn form-control btn-outline-secondary">‰∏äÂÇ≥ÂúñÁâá</label>
                                                    <input type="file" name="img" id="img_sm_{{s.id}}" class="img_btn"
                                                        hidden>
                                                    <button class="btn btn-outline-warning col-2" name="upd"
                                                        value="{{s.id}}">‰øÆÊîπ</button>
                                                    <button class="btn btn-outline-danger col-2" name="del"
                                                        value="{{s.id}}" onclick="return confirm('Á¢∫ÂÆöÂà™Èô§?')">Âà™Èô§</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </form>
                                    {% endfor %}
                                </tbody>
                            </table>


                        </div>
                    </div>


                </div>

            </div>
            {% endif %}
            {% if url=='4' %}
            <div class="order-wrapper cent row_cent mt-5">
                <div class="card order-card col-5">
                    <div class="card-header">
                    <h3>Á¢∫Ë™çË®ÇÂñÆ</h3>
                    </div>
                    <div class="card-body">
                    <form action="/add_food" method="post">

                        <div class="user-info">
                        <h5>ÂßìÂêçÔºö{{ session['user']['name'] }}</h5>
                        <h5>EmailÔºö{{ session['user']['email'] }}</h5>
                        </div>

                        <div class="food-list">
                        <h5>È£üÁâ©Ê∏ÖÂñÆ</h5>
                        {% for i in range(session['tmp_order']['food_type_ids']|length) %}
                            <div class="food-item">
                            <span>{{ session['tmp_order']['food_type_names'][i] }} x {{ session['tmp_order']['counts'][i] }}</span>
                            <span class="price">{{ session['tmp_order']['counts'][i]*session['tmp_order']['prices'][i] }} ÂÖÉ</span>
                            </div>
                        {% endfor %}
                        </div>

                        <h5 class="total-price">Á∏ΩË®àÔºö{{ session['tmp_order']['total'] }} ÂÖÉ</h5>

                        <div class="form-floating">
                        <textarea class="form-control" name="content" placeholder="ÂÇôË®ª ÂèØ‰∏çÂ°´"></textarea>
                        <label>ÂÇôË®ª</label>
                        </div>

                        <div class="order-actions mt-3 d-flex justify-content-between">
                        <button class="btn btn-primary">Á¢∫ÂÆöÈÄÅÂá∫</button>
                        <a href="/?edit=1" class="btn btn-secondary">Âõû‰∏ä‰∏ÄÊ≠•</a>
                        </div>

                    </form>
                    </div>
                </div>
            </div>

            {% endif %}
            <!-- Ë®ÇÂñÆÁÆ°ÁêÜ -->
            {% if url=='5' %}
            <table border="1" cellpadding="8" class="table">
                <thead>
                    <tr>
                        <th>Ë®ÇÂñÆid</th>
                        <th>Á∏ΩÂÉπÊ†º</th>
                        <th class="col-3">ÂÇôË®ª</th>
                        <th>‰ΩøÁî®ËÄÖÂêçÁ®±</th>
                        <th>email</th>
                        <th>ÁãÄÊÖã</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in food %}

                    <tr>
                        <form action="/UpdAndDelFoods" method="post">
                            <td>
                                <h4>{{s.id}}</h4>
                            </td>
                            <td>
                                <h4>{{s.total}}</h4>
                            </td>
                            <td>
                                <h4>
                                    {% if s.content == "" %}
                                    ÁÑ°
                                    {% else %}
                                    {{ s.content }}
                                    {% endif %}
                                </h4>
                            </td>
                            <td>
                                <h4>{{s.user_name}}</h4>
                            </td>
                            <td>
                                <h4>{{s.user_email}}</h4>
                            </td>
                            <td>
                                <span class="status {{ 'done' if s.done == 1 else 'pending' }}">
                                    {{ 'Â∑≤ÂÆåÊàê' if s.done == 1 else 'Ê∫ñÂÇô‰∏≠' }}
                                </span>
                            </td>


                            <td>
                                <button class="btn btn-outline-warning" name="upd" value="{{s.id}}">Ë©≥Á¥∞Ë≥áÊñô</button>
                                <button class="btn btn-outline-danger" name="del" value="{{s.id}}"
                                    onclick="return confirm('Á¢∫ÂÆöÂà™Èô§?')">Âà™Èô§</button>
                            </td>
                        </form>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% endif %}

            {% if 'user' in session and session['user']['level']==1 and url=='6' %}
            <form action="/set_model" method="post">
                <div class="container">

                    <h3>Áï∂ÂâçÊ®°Âûã:</h3>
                    <div class="row">
                        <div class="col">
                            <select class="form-select" name="model" id="modelSelect" onchange="this.form.submit()">
                                {% for m in allmodel %}
                                <option value="{{ m.id }}" {% if ai_config and ai_config['current_model']==m.id
                                    %}selected{% endif %}>
                                    {{ m.name }}
                                </option>
                                {% endfor %}
                            </select>

                        </div>
                        <div class="col-auto">
                            <button type="submit" class="btn btn-outline-primary" name="upd_ai">ÂàáÊèõ</button>

                        </div>
                    </div>
                </div>
            </form>
            {% endif %}


        {% if url=='7' %}
        <div class="container mt-5 mb-5">
            <div class="row justify-content-center">
                <div class="col-md-5">
                    <div class="card topup-card">
                        <!-- {{upd_card_data}} -->
                        <div class="topup-header">
                            <h5 class="mb-1 opacity-75">ÁõÆÂâçÁöÑÈå¢ÂåÖÈ§òÈ°ç</h5>
                            <h1 class="mb-0 fw-bold" style="letter-spacing: 1px;">
                                $ {{ "{:,}".format(upd_card_data.cash|default(0)) }}
                            </h1>
                        </div>

                        <div class="card-body p-4">
                            <form action="/api/topup" method="POST">
                                <input type="hidden" name="target_user_id" value="{{ upd_card_data.id }}">

                                <div class="mb-4">
                                    <label class="form-label fw-bold text-muted small">ÈÅ∏ÊìáÂÑ≤ÂÄºÈáëÈ°ç</label>

                                    <div class="row g-2 mb-3">
                                        <div class="col-4">
                                            <div class="amount-btn" data-amount="100">$100</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="amount-btn" data-amount="300">$300</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="amount-btn" data-amount="500">$500</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="amount-btn" data-amount="1000">$1,000</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="amount-btn" data-amount="3000">$3,000</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="amount-btn" data-amount="5000">$5,000</div>
                                        </div>
                                    </div>

                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control form-control-amount" id="customAmount"
                                            name="amount" placeholder="ÊàñËº∏ÂÖ•Ëá™Ë®ÇÈáëÈ°ç" min="1" required>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-bold text-muted small">ÊîØ‰ªòÊñπÂºè</label>
                                    <!-- {{upd_card_data}} -->
                                    {% if upd_card_data.card_data %}
                                    <select class="form-select form-select-lg" name="card_number" required>
                                        <option value="" selected disabled>Ë´ãÈÅ∏Êìá‰ªòÊ¨æ‰ø°Áî®Âç°</option>
                                        {% for card in upd_card_data.card_data %}
                                        <option value="{{ card.card_number }}">
                                            üí≥ {{ card.bank_name }} (**** {{ card.card_number[-4:] }})
                                            </button>
                                            {% endfor %}
                                    </select>
                                    <div class="form-text mt-2 text-end">
                                        <a href="/?upd_card={{ upd_card_data.id }}"
                                            class="text-decoration-none small">ÁÆ°ÁêÜÊàñÊñ∞Â¢ûÂç°Áâá &rarr;</a>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                                        <div class="me-2">‚ö†Ô∏è</div>
                                        <div>ÊÇ®Â∞öÊú™Á∂ÅÂÆö‰ªª‰Ωï‰ø°Áî®Âç°ÔºåÁÑ°Ê≥ïÂÑ≤ÂÄº„ÄÇ</div>
                                    </div>
                                    <a href="/?upd_card={{ upd_card_data.id }}" class="btn btn-outline-dark w-100">
                                        Ôºã ÂâçÂæÄÁ∂ÅÂÆö‰ø°Áî®Âç°
                                    </a>
                                    {% endif %}
                                </div>

                                <div class="d-grid">
                                    {% if upd_card_data.card_data %}
                                    <button type="submit" class="btn btn-success btn-lg fw-bold"
                                        style="background: #11998e; border:none; border-radius: 10px;">
                                        Á¢∫Ë™çÂÑ≤ÂÄº
                                    </button>
                                    {% else %}
                                    <button type="button" class="btn btn-secondary btn-lg" disabled>
                                        Ë´ãÂÖàÁ∂ÅÂç°
                                    </button>
                                    {% endif %}
                                </div>

                                <div class="text-center mt-3">
                                    <a href="/" class="text-muted small text-decoration-none">ËøîÂõûÈ¶ñÈ†Å</a>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if upd_card_data and url!='7' %}
        <div class="container mt-5 mb-5">
            <div class="row justify-content-center">
                <div class="col-md-10">

                    <div class="card bank-card-container">

                        <div class="card-header bank-card-header text-center">
                            <h4 class="mb-0">üí≥ ÈäÄË°åÂç°ÁÆ°ÁêÜ‰∏≠ÂøÉ</h4>
                            <small style="opacity: 0.8;">ÊúÉÂì°Ôºö{{ upd_card_data.name }}</small>
                            <a href="/?edit=7" class="balance-btn">
                                È§òÈ°çÔºö${{ upd_card_data.cash }} <span style="font-size:0.8em">ÂÑ≤ÂÄº</span>
                            </a>
                        </div>

                        <div class="card-body p-4">
                            <div class="row">
                                <div class="col">

                                    <div class="credit-card-visual" id="cardVisual">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="chip"></div>
                                            <span id="cardLogo"
                                                style="font-weight:bold; font-style:italic; font-size: 1.2rem;">
                                                VISA
                                            </span>
                                        </div>

                                        <div class="card-number-display" id="displayNum">
                                            {% if upd_card_data.card_data %}
                                            {{ upd_card_data.card_data[0].card_number }}
                                            {% else %}
                                            #### #### #### ####
                                            {% endif %}
                                        </div>

                                        <div class="card-info-display">
                                            <div>
                                                <span>Card Holder</span><br>
                                                <span class="card-holder-name">{{ upd_card_data.name }}</span>
                                            </div>
                                            <div>
                                                <span>Bank</span><br>
                                                <span id="displayBank">
                                                    {% if upd_card_data.card_data %}
                                                    {{ upd_card_data.card_data[0].bank_name }}
                                                    {% else %}
                                                    BANK NAME
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    {% if upd_card_data.card_data %}
                                    <div class="mb-5">
                                        <h6 class="text-muted border-bottom pb-2 mb-3">üìÇ Â∑≤Á∂ÅÂÆöÁöÑÂç°Áâá ({{
                                            upd_card_data.card_data|length }})</h6>
                                        <div class="list-group">
                                            {% for card in upd_card_data.card_data %}
                                            <div class="list-group-item d-flex justify-content-between align-items-center border-0 shadow-sm mb-2 rounded"
                                                style="background-color: #f8f9fa;">

                                                <div class="d-flex align-items-center">
                                                    <div class="me-3 fs-4">üí≥</div>
                                                    <div>
                                                        <div class="fw-bold text-dark">{{ card.bank_name }}</div>
                                                        <div class="text-muted small" style="font-family: monospace;">
                                                            **** **** **** {{ card.card_number[-4:] }}
                                                        </div>
                                                    </div>
                                                </div>

                                                <form action="/api/del_card" method="POST" style="margin:0;">
                                                    <input type="hidden" name="target_user_id"
                                                        value="{{ upd_card_data.id }}">
                                                    <input type="hidden" name="card_number"
                                                        value="{{ card.card_number }}">
                                                    <button type="submit" class="btn btn-outline-danger btn-sm"
                                                        onclick="return confirm('Á¢∫ÂÆöË¶ÅÁßªÈô§ÈÄôÂºµÂç°ÁâáÂóéÔºü')">
                                                        üóëÔ∏è ÁßªÈô§
                                                    </button>
                                                </form>

                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}

                                </div>
                                <div class="col">





                                    <form action="/api/add_card" method="POST">
                                        <input type="hidden" name="target_user_id" value="{{ upd_card_data.id }}">

                                        <div class="mb-3">
                                            <label class="form-label text-muted small fw-bold">ÊâÄÂ±¨ÈäÄË°å</label>
                                            <input type="text" class="form-control form-control-custom" id="inputBank"
                                                name="bank_name" placeholder="‰æãÂ¶ÇÔºö‰∏≠Âúã‰ø°Ë®ó" required>
                                        </div>

                                        <div class="mb-4">
                                            <label class="form-label text-muted small fw-bold">‰ø°Áî®Âç°ËôüÁ¢º</label>
                                            <input type="text" class="form-control form-control-custom" id="inputNum"
                                                name="card_number" placeholder="0000 0000 0000 0000" maxlength="19"
                                                required>
                                        </div>

                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary btn-lg"
                                                style="border-radius: 10px; background: #1e3c72; border:none;">
                                                Á´ãÂç≥Á∂ÅÂÆö
                                            </button>
                                            <a href="/?url=2" class="btn btn-outline-secondary"
                                                style="border-radius: 10px;">
                                                ËøîÂõûÂàóË°®
                                            </a>
                                        </div>
                                    </form>
                                </div>



                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif%}


</body>


</html>
