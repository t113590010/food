<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–é </title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <script src="js/script.js"></script>
    <!-- navbar -->
    {% include 'navbar.html' %}

    <!-- body -->
    <!-- AI -->
    <div id="ai-chat-btn">
        ğŸ¤–
    </div>

    <div id="ai-chat-window">
        <div class="chat-header">
            <span>AI é¤å»³å°å¹«æ‰‹</span>
            <span id="chat-close-btn" class="close-btn">Ã—</span>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="message ai-message">
                å—¨ï¼æˆ‘æ˜¯ä½ çš„å°ˆå±¬ AI åŠ©æ‰‹ ğŸ‘‹<br>æƒ³æŸ¥è¨‚å–®æˆ–æ˜¯æ¨è–¦ç¾é£Ÿå—ï¼Ÿ
            </div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="è¼¸å…¥è¨Šæ¯...">
            <button id="chat-send-btn">é€å‡º</button>
        </div>
    </div>
    <!-- é¦–é  æ‰€æœ‰è¨‚å–® -->
    {% if url=='1' or upd_food_data %}
    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col">
                    <h3>æ­¡è¿ä¾†åˆ°...ç¶²ç«™ æº–å‚™å¥½äº«å—ç¾é£Ÿäº†å˜›!</h3>
                </div>
                <div class="col">
                    <h4>ç¸½åƒ¹éŒ¢: <span id="total">0</span>å…ƒ</h4>
                </div>
            </div>



        </div>
        <div class="card-body">
            {% if upd_food_data is not none %}

            <form action="/upd_del_done_food" method="post">
                <div class="container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card p-3">
                                <div class="row g-3">

                                    {% for s in food_types %}
                                    <div class="col-3">
                                        <div class="card p-2 h-100">
                                            <div class="text-center">
                                                <img src="{{ s.img }}" class="pre_img_sm" alt="">
                                            </div>
                                            <h4>é¤é»:{{ s.name }}</h4>
                                            <p>æ•˜è¿°:{{ s.content }}</p>
                                            <div class="mt-auto">
                                                <h5>å‰©é¤˜å­˜è²¨:{{s.count}}</h5>
                                                <h5>å–®åƒ¹: {{ s.price }}å…ƒ</h5>
                                                <label for="count_{{ s.id }}">æ•¸é‡</label>
                                                <input type="number" min="0" max="{{s.count}}"
                                                    class="form-control count" data-price="{{ s.price }}"
                                                    name="count[{{ s.id }}]"
                                                    value="{% if upd_food_data and s.id in upd_food_data['food_type_id'] -%}{{ upd_food_data['food_counts'][upd_food_data['food_type_id'].index(s.id)] -}}{% else %}0{% endif %}"
                                                    required>



                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card p-3">
                                <h3>è¨‚å–®IDï¼š{{upd_food_data['id']}}</h3>
                                <h4>å®¢æˆ¶åç¨±ï¼š{{upd_food_data['user_name']}}</h4>
                                <h4>emailï¼š{{upd_food_data['user_email']}}</h4>
                                <h4>å‚™è¨»ï¼š{{ "ç„¡" if upd_food_data['content'] == "" else upd_food_data['content'] }}</h4>
                                <h4>è¨‚å–®æ—¥æœŸï¼š{{upd_food_data['date']}}</h4>
                                {% if(session['user']['level']) ==1 %}

                                {% if(upd_food_data['done']) ==1 %}
                                {% if(session['user']['id']) ==1 and upd_food_data['user_id'] %}

                                <button type="submit" class="btn btn-outline-success form-control mb-3" name="get"
                                    value="{{upd_food_data['id']}}">é ˜å–</button>

                                {% endif %}
                                <button type="submit" class="btn btn-outline-success form-control" name="Nodone"
                                    value="{{upd_food_data['id']}}">å–æ¶ˆå®Œæˆ</button>

                                {% else %}
                                <button type="submit" class="btn btn-outline-success form-control" name="done"
                                    value="{{upd_food_data['id']}}">å®Œæˆè¨‚å–®</button>
                                {% endif %}
                                {% else %}
                                {% if(upd_food_data['done']) ==1 %}
                                <button type="submit" class="btn btn-outline-success form-control" name="get"
                                    value="{{upd_food_data['id']}}">é ˜å–</button>

                                {% else %}
                                <h4>ç‹€æ…‹ï¼šé¤é»æº–å‚™ä¸­</h4>
                                {% endif %}
                                {% endif %}
                                <div class="row text-center mt-3">
                                    <div class="col">
                                        <button type="submit" class="btn btn-outline-primary form-control" name="upd"
                                            value="{{upd_food_data['id']}}">ä¿®æ”¹é¤é»</button>

                                    </div>

                                    <div class="col">
                                        <button type="submit" class="btn btn-outline-danger form-control" name="del"
                                            value="{{upd_food_data['id']}}">åˆªé™¤è¨‚å–®</button>

                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </form>
            {% else %}
            <div class="main-container">

                <aside class="filter-sidebar">
                    <h3>ğŸ´ ç¯©é¸æ¢ä»¶</h3>

                    <form action="/" method="GET">

                        <input type="hidden" name="keyword" value="{{ request.args.get('keyword', '') }}">

                        <div class="filter-group">
                            <h4>é¤é»é¡åˆ¥</h4>

                            {% for code, name in category_map.items() %}

                            <label class="checkbox-item">
                                <input type="checkbox" name="category" value="{{ code }}" {% if code in
                                    request.args.getlist('category') %} checked {% endif %}>

                                {{ name }}
                            </label>

                            {% endfor %}
                        </div>

                        <div class="filter-group">
                            <h4>åƒ¹æ ¼ç¯„åœ</h4>
                            <div class="price-inputs">
                                <input type="number" name="min_price" placeholder="æœ€ä½"
                                    value="{{ request.args.get('min_price', '') }}">
                                <span> - </span>
                                <input type="number" name="max_price" placeholder="æœ€é«˜"
                                    value="{{ request.args.get('max_price', '') }}">
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4>æ’åº</h4>
                            <label class="radio-item">
                                <input type="radio" name="sort" value="newest" checked> æœ€æ–°ä¸Šæ¶
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="sort" value="price_asc"> åƒ¹æ ¼ï¼šä½åˆ°é«˜
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="sort" value="price_desc"> åƒ¹æ ¼ï¼šé«˜åˆ°ä½
                            </label>
                        </div>

                        <button type="submit" class="filter-btn">å¥—ç”¨ç¯©é¸</button>
                        <a href="/" class="reset-btn">æ¸…é™¤é‡ç½®</a>
                    </form>
                </aside>

                <main class="content-area">

                    <div class="top-search-bar">
                        <form action="/" method="GET" class="search-form">
                            <input type="text" name="keyword" placeholder="æœå°‹æƒ³åƒçš„ç¾é£Ÿ..."
                                value="{{ request.args.get('keyword', '') }}">
                            <button type="submit">ğŸ” æœå°‹</button>
                        </form>
                    </div>
                    <form action="/tmp_food" method="post">

                        <div class="food-grid">
                            {% if food_types %}
                            {% for s in food_types %}


                            <div class="food-card">

                                <div class="text-center">
                                    <img src="{{ s.img }}" class="pre_img card-img" alt="">
                                </div>
                                <div class="card-info">

                                    <h4>é¤é»:{{ s.name }}</h4>
                                    <h5>é¡å‹:{{ category_map[s.type] }}</h5>
                                    <p>æ•˜è¿°:{{ s.content }}</p>
                                    <div class="mt-auto">
                                        <h5>å‰©é¤˜å­˜è²¨:{{s.count}}</h5>
                                        <h5>å–®åƒ¹: {{ s.price }}</h5>
                                        <label for="count_{{ s.id }}">æ•¸é‡</label>
                                        <input type="number" min="0" max="{{s.count}}" class="form-control count"
                                            data-price="{{ s.price }}" name="count[{{ s.id }}]"
                                            value="{% if session.get('tmp_order') and s.id in session['tmp_order']['food_type_ids'] %}{{ session['tmp_order']['counts'][session['tmp_order']['food_type_ids'].index(s.id)] }}{% else %}0{% endif %}">

                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="no-result">
                                <p>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç¾é£Ÿ ğŸ˜­</p>
                            </div>
                            {% endif %}
                        </div>

                        <div class="mt-3 text-center">
                            <button type="submit" class="btn btn-outline-primary">åŠ å…¥é¤é»</button>
                        </div>
                    </form>
                </main>
            </div>

            {% endif %}


        </div>
    </div>

    {% endif %}
    <!-- æœƒå“¡ç®¡ç† -->
    {% if url=='2' %}
    <div class="card">
        <div class="card-header">
            <h2>æœƒå“¡ç®¡ç†</h2>
        </div>
        <div class="card-body">
            <table border="1" cellpadding="8" class="table">
                <thead>
                    <tr>
                        <th>å¸³è™Ÿ</th>
                        <th>å¯†ç¢¼</th>
                        <th>åç¨±</th>
                        <th>email</th>
                        <th>æ¬Šé™</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in users %}
                    <tr>
                        <form action="/UpdAndDelUsers" method="post">
                            <td><input type="text" class="form-control" value="{{ s.account }}" name="account"></td>
                            <td><input type="number" min="1" class="form-control" value="{{ s.password }}"
                                    name="password"></td>
                            <td><input type="name" class="form-control" value="{{ s.name }}" name="name"></td>
                            <td><input type="email" class="form-control" value="{{ s.email }}" name="email"></td>

                            <td>
                                {% if 'user' in session and session['user']['level']==1 %}
                                <select name="level" class="form-select">
                                    <option value="0" {% if 0==s.level %} selected{% endif %}>ä½¿ç”¨è€…</option>
                                    <option value="1" {% if 1==s.level %} selected{% endif %}>ç®¡ç†å“¡</option>
                                </select>
                                {% else %}
                                <p>ä½¿ç”¨è€…
                                <p>
                                    {% endif %}
                            </td>
                            <td>
                                <button class="btn btn-outline-warning" name="upd" value="{{s.id}}">ä¿®æ”¹</button>
                                <button class="btn btn-outline-danger" name="del" value="{{s.id}}"
                                    onclick="return confirm('ç¢ºå®šåˆªé™¤?')">åˆªé™¤</button>
                            </td>
                        </form>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>


        </div>
        {% endif %}
        <!-- é£Ÿç‰©é¡å‹ç®¡ç† -->
        {% if 'user' in session and session['user']['level']==1 and url=='3' %}

        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-5">


                        <h2>æ–°å¢èœå–®é¡å‹</h2>
                        <form action="/add_foodtype" method="post" enctype="multipart/form-data">
                            <div class="row">
                                <div class="row">
                                    <div class="col">
                                        <h5>é è¦½åœ–ç‰‡</h5>
                                        <img src="" class="pre_img" alt="">
                                    </div>
                                    <div class="col">

                                        <label for="img" class="btn form-control btn-outline-secondary">ä¸Šå‚³åœ–ç‰‡</label>
                                        <input type="file" name="img" id="img" hidden>
                                    </div>
                                </div>

                                <label for="">èœå–®é¡å‹åç¨±</label>
                                <input type="text" value="" class="form-control" name="name" required
                                    placeholder="è¼¸å…¥åç¨±">
                                <label for="">é£Ÿç‰©é¡å‹</label>
                                <select name="category" class="form-select">
                                    {% for code, name in category_map.items() %}
                                    <option value="{{ code }}" selected>
                                        {{ name }} </option>
                                    {% endfor %}

                                </select>
                                <label for="">åƒ¹æ ¼</label>
                                <input type="number" min="1" value="" class="form-control" name="price" required
                                    placeholder="è¼¸å…¥åƒ¹æ ¼">
                                <label for="">æ•˜è¿°</label>
                                <textarea name="content" class="form-control" id="" required
                                    placeholder="è¼¸å…¥æ•˜è¿°"></textarea>



                            </div>
                            <div class="mt-3 text-center">
                                <button type="submit" class="btn btn-outline-primary col-3">æ–°å¢</button>
                            </div>
                        </form>

                    </div>
                    <div class="col">
                        <h2>å·²æœ‰èœå–®é¡å‹</h2>
                        <table border="1" cellpadding="8" class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="col-2">åœ–ç‰‡</th>
                                    <th>èœå–®é¡å‹åç¨±</th>
                                    <th class="col-2">é¡å‹</th>
                                    <th class="col-2">åƒ¹éŒ¢</th>
                                    <th class="col-2">å­˜è²¨</th>
                                    <th>æ•˜è¿°</th>
                                    <!-- <th>æ“ä½œ</th> -->
                                </tr>
                            </thead>
                            <tbody>
                                {% for s in food_types %}
                                <form action="/UpdAndDelFoodType" method="post" enctype="multipart/form-data">
                                    <tr>
                                        <td><img src="{{s.img}}" class="pre_img_sm" alt="" id="pre_img_sm_{{s.id}}">
                                        </td>
                                        <td><input type="text" class="form-control" value="{{ s.name }}" name="name">
                                        </td>
                                        <td>
                                            <select name="category" class="form-select">

                                                {% for code, name in category_map.items() %}

                                                <option value="{{ code }}" {% if s.type==code %} selected {% endif %}>

                                                    {{ name }} </option>

                                                {% endfor %}

                                            </select>
                                        </td>
                                        <td><input type="number" min="1" class="form-control" value="{{ s.price }}"
                                                name="price"></td>
                                        <td><input type="number" min="0" class="form-control" value="{{ s.count }}"
                                                name="count"></td>
                                        <td> <textarea class="form-control" name="content"
                                                id="">{{ s.content }}</textarea>
                                        </td>
                                    </tr>
                                    <tr>

                                        <td colspan="5">
                                            <div class="d-flex align-items-center gap-2">

                                                <label for="img_sm_{{s.id}}"
                                                    class="btn form-control btn-outline-secondary">ä¸Šå‚³åœ–ç‰‡</label>
                                                <input type="file" name="img" id="img_sm_{{s.id}}" class="img_btn"
                                                    hidden>
                                                <button class="btn btn-outline-warning col-2" name="upd"
                                                    value="{{s.id}}">ä¿®æ”¹</button>
                                                <button class="btn btn-outline-danger col-2" name="del" value="{{s.id}}"
                                                    onclick="return confirm('ç¢ºå®šåˆªé™¤?')">åˆªé™¤</button>
                                            </div>
                                        </td>
                                    </tr>
                                </form>
                                {% endfor %}
                            </tbody>
                        </table>


                    </div>
                </div>


            </div>

        </div>
        {% endif %}
        {% if url=='4' %}
        <div class="cent row_cent mt-5 ">
            <div class="card col-5">
                <div class="card-header">
                    <h3>ç¢ºèªè¨‚å–®</h3>
                </div>
                <div class="card-body">
                    <form action="/add_food" method="post">
                        <h5>nameï¼š{{session['user']['name']}}</h5>
                        <h5>emailï¼š{{session['user']['email']}}</h5>
                        <h5>é£Ÿç‰©æ¸…å–®</h5>
                        {% for i in range(session['tmp_order']['food_type_ids']|length) %}
                        <span>
                            {{ session['tmp_order']['food_type_names'][i] }}x{{ session['tmp_order']['counts'][i] }} =
                            {{session['tmp_order']['counts'][i]*session['tmp_order']['prices'][i]}}
                        </span>
                        <br>
                        {% endfor %}
                        <h5>ç¸½è¨ˆ{{session['tmp_order']['total']}}å…ƒ</h5>
                        <textarea id="" class="form-control" name="content" placeholder="å‚™è¨» å¯ä¸å¡«"></textarea>


                        <div class="row text-center mt-3">
                            <div class="col">
                                <button class="btn btn-outline-primary" name="submit">ç¢ºå®šé€å‡º</button>

                            </div>
                            <div class="col">
                                <a href="/?edit=1" class="btn btn-outline-secondary">å›ä¸Šä¸€æ­¥</a>

                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
        <!-- è¨‚å–®ç®¡ç† -->
        {% if url=='5' %}
        <table border="1" cellpadding="8" class="table">
            <thead>
                <tr>
                    <th>è¨‚å–®id</th>
                    <th>ç¸½åƒ¹æ ¼</th>
                    <th class="col-3">å‚™è¨»</th>
                    <th>ä½¿ç”¨è€…åç¨±</th>
                    <th>email</th>
                    <th>ç‹€æ…‹</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for s in food %}

                <tr>
                    <form action="/UpdAndDelFoods" method="post">
                        <td>
                            <h4>{{s.id}}</h4>
                        </td>
                        <td>
                            <h4>{{s.total}}</h4>
                        </td>
                        <td>
                            <h4>
                                {% if s.content == "" %}
                                ç„¡
                                {% else %}
                                {{ s.content }}
                                {% endif %}
                            </h4>
                        </td>
                        <td>
                            <h4>{{s.user_name}}</h4>
                        </td>
                        <td>
                            <h4>{{s.user_email}}</h4>
                        </td>
                        <td>{{ 'å·²å®Œæˆ' if s.done == 1 else 'æº–å‚™ä¸­' }}</td>

                        <td>
                            <button class="btn btn-outline-warning" name="upd" value="{{s.id}}">è©³ç´°è³‡æ–™</button>
                            <button class="btn btn-outline-danger" name="del" value="{{s.id}}"
                                onclick="return confirm('ç¢ºå®šåˆªé™¤?')">åˆªé™¤</button>
                        </td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% endif %}

        {% if 'user' in session and session['user']['level']==1 and url=='6' %}
        <form action="/set_model" method="post">
            <div class="container">

                <h3>ç•¶å‰æ¨¡å‹:</h3>
                <div class="row">
                    <div class="col">
                        <select class="form-select" name="model" id="modelSelect" onchange="this.form.submit()">
                            {% for m in allmodel %}
                            <option value="{{ m.id }}" {% if ai_config and ai_config['current_model']==m.id %}selected{%
                                endif %}>
                                {{ m.name }}
                            </option>
                            {% endfor %}
                        </select>

                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-outline-primary" name="upd_ai">åˆ‡æ›</button>

                    </div>
                </div>
            </div>
        </form>
        {% endif %}

        {% if url=='7' %}

        {% endif %}


</body>

</html>