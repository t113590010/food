<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>È¶ñÈ†Å</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <script src="js/script.js"></script>
    <!-- navbar -->
    {% include 'navbar.html' %}

    <!-- body -->
    <!-- È¶ñÈ†Å ÊâÄÊúâË®ÇÂñÆ -->
    {% if url=='1' or upd_food_data %}
    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col">
                    <h3>Ê≠°Ëøé‰æÜÂà∞...Á∂≤Á´ô Ê∫ñÂÇôÂ•Ω‰∫´ÂèóÁæéÈ£ü‰∫ÜÂòõ!</h3>
                </div>
                <div class="col">
                    <h4>Á∏ΩÂÉπÈå¢: <span id="total">0</span>ÂÖÉ</h4>
                </div>
            </div>



        </div>
        <div class="card-body">
            {% if upd_food_data is not none %}

            <form action="/upd_del_done_food" method="post">
                <div class="container">
                    <div class="row">
                        <div class="col-8">
                            <div class="card p-3">
                                <div class="row g-3">

                                    {% for s in food_types %}
                                    <div class="col-3">
                                        <div class="card p-2 h-100">
                                            <div class="text-center">
                                                <img src="{{ s.img }}" class="pre_img_sm" alt="">
                                            </div>
                                            <h4>È§êÈªû:{{ s.name }}</h4>
                                            <p>ÊïòËø∞:{{ s.content }}</p>
                                            <div class="mt-auto">
                                                <h5>Ââ©È§òÂ≠òË≤®:{{s.count}}</h5>
                                                <h5>ÂñÆÂÉπ: {{ s.price }}ÂÖÉ</h5>
                                                <label for="count_{{ s.id }}">Êï∏Èáè</label>
                                                <input type="number" min="0" max="{s.count}" class="form-control count" 
                                                    data-price="{{ s.price }}" name="count[{{ s.id }}]"
                                                    value="{% if upd_food_data and s.id in upd_food_data['food_type_id'] -%}{{ upd_food_data['food_counts'][upd_food_data['food_type_id'].index(s.id)] -}}{% else %}0{% endif %}"
                                                    required>



                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card p-3">
                                <h3>Ë®ÇÂñÆIDÔºö{{upd_food_data['id']}}</h3>
                                <h4>ÂÆ¢Êà∂ÂêçÁ®±Ôºö{{upd_food_data['user_name']}}</h4>
                                <h4>emailÔºö{{upd_food_data['user_email']}}</h4>
                                <h4>ÂÇôË®ªÔºö{{ "ÁÑ°" if upd_food_data['content'] == "" else upd_food_data['content'] }}</h4>
                                <h4>Ë®ÇÂñÆÊó•ÊúüÔºö{{upd_food_data['date']}}</h4>
                                {% if(session['user']['level']) ==1 %}

                                {% if(upd_food_data['done']) ==1 %}
                                {% if(session['user']['id']) ==1 and upd_food_data['user_id'] %}

                                <button type="submit" class="btn btn-outline-success form-control mb-3" name="get"
                                    value="{{upd_food_data['id']}}">È†òÂèñ</button>

                                {% endif %}
                                <button type="submit" class="btn btn-outline-success form-control" name="Nodone"
                                    value="{{upd_food_data['id']}}">ÂèñÊ∂àÂÆåÊàê</button>

                                {% else %}
                                <button type="submit" class="btn btn-outline-success form-control" name="done"
                                    value="{{upd_food_data['id']}}">ÂÆåÊàêË®ÇÂñÆ</button>
                                {% endif %}
                                {% else %}
                                {% if(upd_food_data['done']) ==1 %}
                                <button type="submit" class="btn btn-outline-success form-control" name="get"
                                    value="{{upd_food_data['id']}}">È†òÂèñ</button>

                                {% else %}
                                <h4>ÁãÄÊÖãÔºöÈ§êÈªûÊ∫ñÂÇô‰∏≠</h4>
                                {% endif %}
                                {% endif %}
                                <div class="row text-center mt-3">
                                    <div class="col">
                                        <button type="submit" class="btn btn-outline-primary form-control" name="upd"
                                            value="{{upd_food_data['id']}}">‰øÆÊîπÈ§êÈªû</button>

                                    </div>

                                    <div class="col">
                                        <button type="submit" class="btn btn-outline-danger form-control" name="del"
                                            value="{{upd_food_data['id']}}">Âà™Èô§Ë®ÇÂñÆ</button>

                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </form>
            {% else %}
            <div class="main-container">

                <aside class="filter-sidebar">
                    <h3>üç¥ ÁØ©ÈÅ∏Ê¢ù‰ª∂</h3>

                    <form action="/" method="GET">

                        <input type="hidden" name="keyword" value="{{ request.args.get('keyword', '') }}">

                        <div class="filter-group">
                            <h4>È§êÈªûÈ°ûÂà•</h4>

                            {% for code, name in category_map.items() %}

                            <label class="checkbox-item">
                                <input type="checkbox" name="category" value="{{ code }}" {% if code in
                                    request.args.getlist('category') %} checked {% endif %}>

                                {{ name }}
                            </label>

                            {% endfor %}
                        </div>

                        <div class="filter-group">
                            <h4>ÂÉπÊ†ºÁØÑÂúç</h4>
                            <div class="price-inputs">
                                <input type="number" name="min_price" placeholder="ÊúÄ‰Ωé"
                                    value="{{ request.args.get('min_price', '') }}">
                                <span> - </span>
                                <input type="number" name="max_price" placeholder="ÊúÄÈ´ò"
                                    value="{{ request.args.get('max_price', '') }}">
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4>ÊéíÂ∫è</h4>
                            <label class="radio-item">
                                <input type="radio" name="sort" value="newest" checked> ÊúÄÊñ∞‰∏äÊû∂
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="sort" value="price_asc"> ÂÉπÊ†ºÔºö‰ΩéÂà∞È´ò
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="sort" value="price_desc"> ÂÉπÊ†ºÔºöÈ´òÂà∞‰Ωé
                            </label>
                        </div>

                        <button type="submit" class="filter-btn">Â•óÁî®ÁØ©ÈÅ∏</button>
                        <a href="/" class="reset-btn">Ê∏ÖÈô§ÈáçÁΩÆ</a>
                    </form>
                </aside>

                <main class="content-area">

                    <div class="top-search-bar">
                        <form action="/" method="GET" class="search-form">
                            <input type="text" name="keyword" placeholder="ÊêúÂ∞ãÊÉ≥ÂêÉÁöÑÁæéÈ£ü..."
                                value="{{ request.args.get('keyword', '') }}">
                            <button type="submit">üîç ÊêúÂ∞ã</button>
                        </form>
                    </div>
                    <form action="/tmp_food" method="post">

                        <div class="food-grid">
                            {% if food_types %}
                            {% for s in food_types %}


                            <div class="food-card">

                                <div class="text-center">
                                    <img src="{{ s.img }}" class="pre_img card-img" alt="">
                                </div>
                                <div class="card-info">

                                    <h4>È§êÈªû:{{ s.name }}</h4>
                                    <h5>È°ûÂûã:{{ category_map[s.type] }}</h5>
                                    <p>ÊïòËø∞:{{ s.content }}</p>
                                    <div class="mt-auto">
                                        <h5>Ââ©È§òÂ≠òË≤®:{{s.count}}</h5>
                                        <h5>ÂñÆÂÉπ: {{ s.price }}</h5>
                                        <label for="count_{{ s.id }}">Êï∏Èáè</label>
                                        <input type="number" min="0" max="{{s.count}}" class="form-control count"
                                            data-price="{{ s.price }}" name="count[{{ s.id }}]"
                                            value="{% if session.get('tmp_order') and s.id in session['tmp_order']['food_type_ids'] %}{{ session['tmp_order']['counts'][session['tmp_order']['food_type_ids'].index(s.id)] }}{% else %}0{% endif %}">

                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="no-result">
                                <p>Ê≤íÊúâÊâæÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁæéÈ£ü üò≠</p>
                            </div>
                            {% endif %}
                        </div>

                        <div class="mt-3 text-center">
                            <button type="submit" class="btn btn-outline-primary">Âä†ÂÖ•È§êÈªû</button>
                        </div>
                    </form>
                </main>
            </div>

            {% endif %}


        </div>
    </div>

    {% endif %}
    <!-- ÊúÉÂì°ÁÆ°ÁêÜ -->
    {% if url=='2' %}
    <div class="card">
        <div class="card-header">
            <h2>ÊúÉÂì°ÁÆ°ÁêÜ</h2>
        </div>
        <div class="card-body">
            <table border="1" cellpadding="8" class="table">
                <thead>
                    <tr>
                        <th>Â∏≥Ëôü</th>
                        <th>ÂØÜÁ¢º</th>
                        <th>ÂêçÁ®±</th>
                        <th>email</th>
                        <th>Ê¨äÈôê</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in users %}
                    <tr>
                        <form action="/UpdAndDelUsers" method="post">
                            <td><input type="text" class="form-control" value="{{ s.account }}" name="account"></td>
                            <td><input type="number" min="1" class="form-control" value="{{ s.password }}"
                                    name="password"></td>
                            <td><input type="name" class="form-control" value="{{ s.name }}" name="name"></td>
                            <td><input type="email" class="form-control" value="{{ s.email }}" name="email"></td>

                            <td>
                                {% if 'user' in session and session['user']['level']==1 %}
                                <select name="level" class="form-select">
                                    <option value="0" {% if 0==s.level %} selected{% endif %}>‰ΩøÁî®ËÄÖ</option>
                                    <option value="1" {% if 1==s.level %} selected{% endif %}>ÁÆ°ÁêÜÂì°</option>
                                </select>
                                {% else %}
                                <p>‰ΩøÁî®ËÄÖ
                                <p>
                                    {% endif %}
                            </td>
                            <td>
                                <button class="btn btn-outline-warning" name="upd" value="{{s.id}}">‰øÆÊîπ</button>
                                <button class="btn btn-outline-danger" name="del" value="{{s.id}}"
                                    onclick="return confirm('Á¢∫ÂÆöÂà™Èô§?')">Âà™Èô§</button>
                            </td>
                        </form>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>


        </div>
        {% endif %}
        <!-- È£üÁâ©È°ûÂûãÁÆ°ÁêÜ -->
        {% if 'user' in session and session['user']['level']==1 and url=='3' %}

        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-5">


                        <h2>Êñ∞Â¢ûËèúÂñÆÈ°ûÂûã</h2>
                        <form action="/add_foodtype" method="post" enctype="multipart/form-data">
                            <div class="row">
                                <div class="row">
                                    <div class="col">
                                        <h5>È†êË¶ΩÂúñÁâá</h5>
                                        <img src="" class="pre_img" alt="">
                                    </div>
                                    <div class="col">

                                        <label for="img" class="btn form-control btn-outline-secondary">‰∏äÂÇ≥ÂúñÁâá</label>
                                        <input type="file" name="img" id="img" hidden>
                                    </div>
                                </div>

                                <label for="">ËèúÂñÆÈ°ûÂûãÂêçÁ®±</label>
                                <input type="text" value="" class="form-control" name="name" required
                                    placeholder="Ëº∏ÂÖ•ÂêçÁ®±">
                                <label for="">È£üÁâ©È°ûÂûã</label>
                                <select name="category" class="form-select">
                                    {% for code, name in category_map.items() %}
                                    <option value="{{ code }}" selected>
                                        {{ name }} </option>
                                    {% endfor %}

                                </select>
                                <label for="">ÂÉπÊ†º</label>
                                <input type="number" min="1" value="" class="form-control" name="price" required
                                    placeholder="Ëº∏ÂÖ•ÂÉπÊ†º">
                                <label for="">ÊïòËø∞</label>
                                <textarea name="content" class="form-control" id="" required
                                    placeholder="Ëº∏ÂÖ•ÊïòËø∞"></textarea>



                            </div>
                            <div class="mt-3 text-center">
                                <button type="submit" class="btn btn-outline-primary col-3">Êñ∞Â¢û</button>
                            </div>
                        </form>

                    </div>
                    <div class="col">
                        <h2>Â∑≤ÊúâËèúÂñÆÈ°ûÂûã</h2>
                        <table border="1" cellpadding="8" class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="col-2">ÂúñÁâá</th>
                                    <th>ËèúÂñÆÈ°ûÂûãÂêçÁ®±</th>
                                    <th class="col-2">È°ûÂûã</th>
                                    <th class="col-2">ÂÉπÈå¢</th>
                                    <th class="col-2">Â≠òË≤®</th>
                                    <th>ÊïòËø∞</th>
                                    <!-- <th>Êìç‰Ωú</th> -->
                                </tr>
                            </thead>
                            <tbody>
                                {% for s in food_types %}
                                <form action="/UpdAndDelFoodType" method="post" enctype="multipart/form-data">
                                    <tr>
                                        <td><img src="{{s.img}}" class="pre_img_sm" alt="" id="pre_img_sm_{{s.id}}">
                                        </td>
                                        <td><input type="text" class="form-control" value="{{ s.name }}" name="name">
                                        </td>
                                        <td>
                                            <select name="category" class="form-select">

                                                {% for code, name in category_map.items() %}

                                                <option value="{{ code }}" {% if s.type==code %} selected {% endif %}>

                                                    {{ name }} </option>

                                                {% endfor %}

                                            </select>
                                        </td>
                                        <td><input type="number" min="1" class="form-control" value="{{ s.price }}"
                                                name="price"></td>
                                        <td><input type="number" min="0" class="form-control" value="{{ s.count }}"
                                                name="count"></td>
                                        <td> <textarea class="form-control" name="content"
                                                id="">{{ s.content }}</textarea>
                                        </td>
                                    </tr>
                                    <tr>

                                        <td colspan="5">
                                            <div class="d-flex align-items-center gap-2">

                                                <label for="img_sm_{{s.id}}"
                                                    class="btn form-control btn-outline-secondary">‰∏äÂÇ≥ÂúñÁâá</label>
                                                <input type="file" name="img" id="img_sm_{{s.id}}" class="img_btn"
                                                    hidden>
                                                <button class="btn btn-outline-warning col-2" name="upd"
                                                    value="{{s.id}}">‰øÆÊîπ</button>
                                                <button class="btn btn-outline-danger col-2" name="del" value="{{s.id}}"
                                                    onclick="return confirm('Á¢∫ÂÆöÂà™Èô§?')">Âà™Èô§</button>
                                            </div>
                                        </td>
                                    </tr>
                                </form>
                                {% endfor %}
                            </tbody>
                        </table>


                    </div>
                </div>


            </div>

        </div>
        {% endif %}
        {% if url=='4' %}
        <div class="cent row_cent mt-5 ">
            <div class="card col-5">
                <div class="card-header">
                    <h3>Á¢∫Ë™çË®ÇÂñÆ</h3>
                </div>
                <div class="card-body">
                    <form action="/add_food" method="post">
                        <h5>nameÔºö{{session['user']['name']}}</h5>
                        <h5>emailÔºö{{session['user']['email']}}</h5>
                        <h5>È£üÁâ©Ê∏ÖÂñÆ</h5>
                        {% for i in range(session['tmp_order']['food_type_ids']|length) %}
                        <span>
                            {{ session['tmp_order']['food_type_names'][i] }}x{{ session['tmp_order']['counts'][i] }} =
                            {{session['tmp_order']['counts'][i]*session['tmp_order']['prices'][i]}}
                        </span>
                        <br>
                        {% endfor %}
                        <h5>Á∏ΩË®à{{session['tmp_order']['total']}}ÂÖÉ</h5>
                        <textarea id="" class="form-control" name="content" placeholder="ÂÇôË®ª ÂèØ‰∏çÂ°´"></textarea>


                        <div class="row text-center mt-3">
                            <div class="col">
                                <button class="btn btn-outline-primary" name="submit">Á¢∫ÂÆöÈÄÅÂá∫</button>

                            </div>
                            <div class="col">
                                <a href="/?edit=1" class="btn btn-outline-secondary">Âõû‰∏ä‰∏ÄÊ≠•</a>

                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
        <!-- Ë®ÇÂñÆÁÆ°ÁêÜ -->
        {% if url=='5' %}
        <table border="1" cellpadding="8" class="table">
            <thead>
                <tr>
                    <th>Ë®ÇÂñÆid</th>
                    <th>Á∏ΩÂÉπÊ†º</th>
                    <th class="col-3">ÂÇôË®ª</th>
                    <th>‰ΩøÁî®ËÄÖÂêçÁ®±</th>
                    <th>email</th>
                    <th>ÁãÄÊÖã</th>
                    <th>Êìç‰Ωú</th>
                </tr>
            </thead>
            <tbody>
                {% for s in food %}

                <tr>
                    <form action="/UpdAndDelFoods" method="post">
                        <td>
                            <h4>{{s.id}}</h4>
                        </td>
                        <td>
                            <h4>{{s.total}}</h4>
                        </td>
                        <td>
                            <h4>
                                {% if s.content == "" %}
                                ÁÑ°
                                {% else %}
                                {{ s.content }}
                                {% endif %}
                            </h4>
                        </td>
                        <td>
                            <h4>{{s.user_name}}</h4>
                        </td>
                        <td>
                            <h4>{{s.user_email}}</h4>
                        </td>
                        <td>{{ 'Â∑≤ÂÆåÊàê' if s.done == 1 else 'Ê∫ñÂÇô‰∏≠' }}</td>

                        <td>
                            <button class="btn btn-outline-warning" name="upd" value="{{s.id}}">Ë©≥Á¥∞Ë≥áÊñô</button>
                            <button class="btn btn-outline-danger" name="del" value="{{s.id}}"
                                onclick="return confirm('Á¢∫ÂÆöÂà™Èô§?')">Âà™Èô§</button>
                        </td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% endif %}
        {% if 'user' in session and session['user']['level']==1 and url=='6' %}
        {% endif %}


</body>

</html>